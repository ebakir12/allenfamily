<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_mixing_report">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.internal_layout">
                    <div class="page" style="font-size: 14px;font-family:Arial,sans,Lucida Grande,Calibri;">

                        <div class="oe_structure"/>

<!--                        <t t-if="o.product_id.default_code == '20024' or o.product_id.default_code == '20025' or o.product_id.default_code == '20026' or o.product_id.default_code == '20030' or o.product_id.default_code == '20038' or o.product_id.default_code == '20039' or o.product_id.default_code == '20040' or o.product_id.default_code == '20041' or o.product_id.default_code == '20048' or o.product_id.default_code == '20049' or o.product_id.default_code == '20050' or o.product_id.default_code == '20051' or o.product_id.default_code == '20052' or o.product_id.default_code == '20053' or o.product_id.default_code == '20054' or o.product_id.default_code == '20055' or o.product_id.default_code == '20056'">-->
                            <t t-set="line_per_page" t-value="45"/>
                            <!--                            <t t-set="line_per_page" t-value="15"/>-->
                            <t t-set="line_per_header" t-value="6"/>
                            <t t-set="line_per_footer" t-value="2"/>
                            <t t-set="column_no" t-value="25"/>

                            <t t-set="curLine" t-value="0"/>
                            <t t-set="groupLine" t-value="str(line_per_header)"/>

                            <t t-set="uom" t-value="o.product_uom_id.name" groups="product.group_uom"/>
                            <!--                            <t t-if="'Batch' in uom">-->

                            <t t-foreach="o.move_raw_ids.sorted(key=lambda b: b.product_id.default_code)" t-as="line">
                                <t t-if="line.product_id.default_code != '39999'">
                                    <t t-set="curLine" t-value="1"/>

                                    <!--                                        <t t-if="len(o._get_top_three_lot_ids(line.product_id.id)) > 0">-->
                                    <!--                                            <t t-foreach="o._get_top_three_lot_ids(line.product_id.id)" t-as="lot_id_line">-->
                                    <!--                                                <t t-set="curLine" t-value="curLine+1"/>-->
                                    <!--                                            </t>-->
                                    <!--                                            <t t-set="curLine" t-value="curLine+1"/>-->
                                    <!--                                        </t>-->
                                    <!--                                        <t t-else="">-->
                                    <!--                                            <t t-set="curLine" t-value="curLine+1"/>-->
                                    <!--                                        </t>-->


                                    <t t-foreach="o._get_top_three_lot_ids(line.product_id.id)" t-as="lot_id_line">
                                        <t t-set="curLine" t-value="curLine+1"/>
                                    </t>
                                    <t t-set="curLine" t-value="curLine+1"/>

                                    <t t-set="groupLine" t-value="groupLine + ',' + str(curLine)"/>
                                </t>
                            </t>

                            <t t-set="groupLine" t-value="groupLine + ',' + str(line_per_footer)"/>

                            <!--                            <t t-esc="groupLine"/><br/>-->

                            <t t-set="pageLine" t-value="'0'"/>
                            <t t-set="cur_group_idx" t-value="0"/>
                            <t t-set="curLineNo" t-value="0"/>

                            <t t-set="groupLine_index" t-value="groupLine.split(',')"/>
                            <t t-foreach="groupLine_index" t-as="group">
                                <t t-if="curLineNo + int(group) > line_per_page">
                                    <t t-set="pageLine" t-value="pageLine + ',' + str(cur_group_idx)"/>
                                    <t t-set="curLineNo" t-value="0"/>
                                </t>
                                <t t-set="curLineNo" t-value="curLineNo+int(group)"/>
                                <t t-set="cur_group_idx" t-value="cur_group_idx+1"/>
                            </t>

                            <!--                            <t t-esc="pageLine"/><br/>-->

                            <t t-foreach="range(o.totalpage+1)" t-as="page">
                                <!--                            <t t-foreach="range(1)" t-as="page">-->
                                <t t-set="first_page" t-value="True"/>
                                <t t-set="pageLine_index" t-value="pageLine.split(',')"/>
                                <t t-set="cur_page_index" t-value="1"/>

                                <t t-if="first_page">
                                    <div class="row text-left" style="margin-left:0px;padding:0px;margin:0px;">
                                        <div class="col-xs-3">
                                            <img t-if="o.company_id.logo"
                                                 t-att-src="'data:image/png;base64,%s' % o.company_id.logo"
                                                 style="padding-top:0px"/>
                                        </div>
                                        <div class="col-xs-6 text-center" style="padding:0px;margin:0px;">
                                            <h2 style="padding:0px;margin:0px;">Consumed Material Log</h2>
                                        </div>
                                        <div class="col-xs-3 text-right" style="padding-top:20px;">
                                            <strong>Date:</strong>
                                            <span t-field="o.date_planned_start"/>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="row col-xs-12" style="padding: 0px 0px 0px 0px; margin:0px ">
                                            <div class="col-xs-12">
                                                <strong>
                                                    <span t-field="o.product_id"/>
                                                </strong>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="row mb8 col-xs-9"
                                             style="border: 1px solid #000; padding: 3px 0px 2px 0px; margin-left:0px;width:74%">
                                            <div class="col-xs-8">
                                                <strong>
                                                    <span t-field="o.name"/>
                                                </strong>
                                            </div>
<!--                                            <div class="col-xs-4 text-right">-->
<!--                                                <span t-field="o.routing_id"/>-->
<!--                                            </div>-->
                                            <div class="col-xs-12">
                                                <strong>Order Qty:</strong>
                                                <span t-field="o.product_qty"/>
                                                <span t-field="o.product_uom_id.name" groups="product.group_uom"/>
                                                <t t-if="page==0">
                                                    <span style="padding-left:20px;">
                                                        <strong>Actual:</strong> AM_________ PM_________ GY_________
                                                    </span>
                                                </t>
                                            </div>
                                            <div class="col-xs-12">
                                                <strong>Lot Number:</strong>
<!--                                                <span t-field="o.workorder_ids[0].final_lot_id"/>-->
                                                    <span t-field="o.lot_producing_id"/>
                                            </div>
                                        </div>
                                        <div class="row mb8 col-xs-3"
                                             style="border: 1px solid #000; margin-left: 14px; margin-right:0px;padding: 5px 0px;font-size:8px;;width:26%">
                                            <div class="col-xs-4 text-left" style="width:43%">
                                                Doc. No.:
                                            </div>
                                            <div class="col-xs-8 text-left" style="padding-left:0px;width:57%">
<!--                                                <t t-set="lookup_long" t-value="o.product_id.lookup_code.split(' ')"/>
                                                <t t-set="lookup" t-value="lookup_long[0].split('-')"/>
                                                <span t-if="lookup[0] == 'GRN'" t-esc="'INNO-PROD-P10-L01-GRN'"/>
                                                <span t-elif="lookup[0] == 'TBS'" t-esc="'INNO-PROD-P07-L01-TBS'"/>
                                                <span t-elif="lookup[0] == 'TBC'" t-esc="'INNO-PROD-P07-L01-TBC'"/>
                                                <span t-elif="lookup[0] == 'JRS'" t-esc="'INNO-PROD-P14-L01-JRS'"/>
                                                <span t-else="" t-esc="'INNO-PROD-P01-L01-' + lookup[0]"/>-->
                                            </div>
                                            <div class="col-xs-6 text-left" style="width:43%">
                                                Issue No.:
                                            </div>
                                            <div class="col-xs-6 text-left" style="padding-left:0px">
<!--                                                <t t-set="lookup_long" t-value="o.product_id.lookup_code.split(' ')"/>
                                                <t t-set="lookup" t-value="lookup_long[0].split('-')"/>
                                                <span t-if="lookup[0] == 'JRS'" t-esc="'001'"/>
                                                <span t-else="" t-esc="'10'"/>-->
                                            </div>
                                            <div class="col-xs-6 text-left" style="width:43%">
                                                Effective Date:
                                            </div>
                                            <div class="col-xs-6 text-left" style="padding-left:0px">
<!--                                                <t t-set="lookup_long" t-value="o.product_id.lookup_code.split(' ')"/>
                                                <t t-set="lookup" t-value="lookup_long[0].split('-')"/>
                                                <span t-if="lookup[0] == 'JRS'" t-esc="'July 27, 2020'"/>
                                                <span t-else="" t-esc="'April 29. 2019'"/>-->
                                            </div>
                                            <div class="col-xs-6 text-left" style="width:43%">
                                                Issued By:
                                            </div>
                                            <div class="col-xs-6 text-left" style="padding-left:0px">
                                                Shabnam Chamarana
                                            </div>
                                            <div class="col-xs-6 text-left" style="width:43%">
                                                Approved By:
                                            </div>
                                            <div class="col-xs-6 text-left" style="padding-left:0px">
                                                Jae Park
                                            </div>
                                        </div>
                                    </div>
                                    <t t-set="first_page" t-value="False"/>
                                </t>


                                <p t-if="str(cur_page_index) in pageLine_index" style="page-break-before:always;"/>


                                <t t-set="cur_page_index" t-value="cur_page_index+1"/>

                                <t t-if="o.move_raw_ids">
                                    <t t-foreach="o.move_raw_ids.sorted(key=lambda b: b.product_id.default_code)"
                                       t-as="line">
                                        <t t-if="line.product_id.default_code != '39999'">
                                            <t t-set="BOM_unit" t-value="True"/>
                                            <table class="table table-condensed" t-if="o.move_raw_ids"
                                                   style="margin:0px 0px 0px -2px; padding:0px; font-size:11px;">
                                                <thead>
                                                    <tr>
                                                        <td class="text-left" style="padding:3px">
                                                            <div t-field="line.product_id"
                                                                 style="overflow:hidden;height:15px;font-size:12px"/>
                                                        </td>
                                                        <td class="text-right" style="padding:3px">
                                                            <span>
                                                                <span t-esc="round(sum(o.bom_id.bom_line_ids.filtered(lambda x: x.id == line.bom_line_id.id).mapped('product_qty')),2)"/>
                                                            </span>
                                                        </td>
                                                        <t t-foreach="range(column_no)" t-as="column">
                                                            <td class="text-center"
                                                                style="border:1px solid #666; width: 25px;padding:3px">
                                                                <span t-esc="column + 1 + page * column_no"
                                                                      style="letter-spacing:-1"/>
                                                            </td>
                                                        </t>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!--                                                        <t t-if="len(o._get_top_three_lot_ids(line.product_id.id)) > 0">-->
                                                    <t t-foreach="o._get_top_three_lot_ids(line.product_id.id)"
                                                       t-as="lot_id_line">
                                                        <tr>
                                                            <td class="text-center"
                                                                style="overflow:hidden;height:15px;font-size:12px;padding:3px">
                                                                <!-- Get the lot codes from _get_top_three_lot_ids method. -->
                                                                <span t-field="lot_id_line.name"/>
                                                            </td>
                                                            <td class="text-right" style="padding:3px">
                                                                <span t-if="BOM_unit"
                                                                      t-esc="line.bom_line_id.product_uom_id.name"
                                                                      groups="product.group_uom"/>
                                                            </td>
                                                            <t t-foreach="range(column_no)" t-as="column">
                                                                <td style="border:1px solid #666;padding:3px"></td>
                                                            </t>
                                                        </tr>
                                                        <t t-set="BOM_unit" t-value="False"/>
                                                    </t>
                                                    <!--                                                        </t>-->
                                                    <!--                                                        <t t-else="">-->
                                                    <tr>
                                                        <td style="padding:3px"></td>
                                                        <td class="text-right" style="padding:3px">
                                                            <span t-if="BOM_unit"
                                                                  t-esc="line.bom_line_id.product_uom_id.name"
                                                                  groups="product.group_uom"/>
                                                        </td>
                                                        <t t-foreach="range(column_no)" t-as="column">
                                                            <td style="border:1px solid #666; height:22px; padding:3px"></td>
                                                        </t>
                                                    </tr>
                                                    <!--                                                        </t>-->
                                                </tbody>
                                            </table>


                                            <p t-if="str(cur_page_index) in pageLine_index"
                                               style="page-break-before:always;"/>


                                            <t t-set="cur_page_index" t-value="cur_page_index+1"/>
                                        </t>
                                    </t>
                                </t>

                                <p t-if="str(cur_page_index) in pageLine_index" style="page-break-before:always;"/>

                                <div class="row mt8 col-xs-8 text-center"
                                     style="border: 1px solid #000; padding: 12px 0px 5px 0px; margin-left:0px;">
                                    <strong>Supervisor :</strong>
                                    AM _______________ PM _______________ GY _______________
                                </div>
                                <div class="row mt8 col-xs-4 text-center"
                                     style="border: 1px solid #000; padding: 12px 0px 5px 0px; margin-left: 14px; margin-right:0px;">
                                    <strong>QA</strong>
                                    _______________ Date _________
                                </div>

                                <p style="page-break-before:always;"></p>
                            </t>
                            <!--                            </t>
                                                        <t t-else="">
                                                            <div class="row text-center">
                                                            <span style="font-size:50px">
                                                            <t t-esc="'Preparing Report'"/>
                                                            </span>
                                                            </div>
                                                        </t>-->
<!--                        </t>-->
                        <div class="oe_structure"/>
                    </div>
                </t>
            </t>
        </t>
    </template>
    <report
            string="Consumed Material Report"
            id="action_report_mixing_report"
            model="mrp.production"
            name="mrp_mixing_report.report_mixing_report"
            report_type="qweb-pdf"
    />
</odoo>
