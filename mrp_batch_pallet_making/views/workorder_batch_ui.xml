<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="mrp_batch_ui" model="ir.ui.view">
        <field name="name">mrp.production.work.order.form</field>
        <field name="model">mrp.workorder</field>
        <field name="arch" type="xml">
            <form string="Production Workcenter" delete="0" create="0" class="frm_batch">
                <field name="_barcode_scanned" widget="workorder_barcode_handler"/>
                <sheet>
                    <div style="background-color:#ffb3b3; border: #ff0303 1px solid; text-align: center; padding:10px; margin-bottom:10px;" attrs="{'invisible': [('skip_packing_rules', '=', False)]}">
                          Warning: This workorder is set to use Normal Workcenter Rules, and should not be completed using this view. Please go to the manufacturing order to open the workorder.
                    </div>
                    <div>
                        <field name="skip_packing_rules" invisible="1" />
                        <field name="is_user_working" invisible="1"/>
                        <field name="working_state" invisible="1"/>
                        <field name="production_state" invisible="1"/>
                        <field name="is_produced" invisible="1"/>
                        <field name="product_tracking" invisible="1"/>
                        <field name="move_raw_ids" invisible="1"/>
                        <field name="state" widget="statusbar" statusbar_visible="pending,ready,progress,done" invisible="1"/>
                        <field name="date_planned_start" invisible="1" />
                        <field name="company_id" invisible="1" />
                    </div>

                    <div class="batch_info_box">
                        <div class="box-production">
                            <field name="production_id" readonly="1"  options="{'no_open': True}" class="production"/>
                        </div>
                        <div class="box-product">
                            <field name="product_id"  options="{'no_open': True}" class="product"/>
                        </div>
                        <div class="box-qty_production">
                            <!-- qty_production includes the full order quantity.
                                 qty_producing is the qty of the batch. -->
                            <span class="lbl_title">&#8226; Order Qty: </span>
<!--                            <field name="qty_production" readonly="1"  options="{'no_open': True}" string="Order Qty" class="qty_production"/>-->
                            <field name="product_qty_per_workcenter" readonly="1"  options="{'no_open': True}" string="Order Qty" class="qty_production"/>
                            <field name="product_uom_id"  options="{'no_open': True}" class="product_uom"/>
                        </div>
                        <div class="box-qty_producing" groups="base.group_no_one">
                            <span class="lbl_title">&#8226; Producing Qty: </span>
                            <field name="qty_producing" readonly="1"  options="{'no_open': True}" string="Order Qty" class="qty_producing"/>
                            <field name="product_uom_id"  options="{'no_open': True}" class="product_uom"/>
                        </div>
                        
                         <!-- <button name="action_confirm" type="object" string="Finish Order"
                                context="{'clicked_finish': True}"
                                class="btn-info btn-big"/>  -->
                        
                        <div class="box-final_lot">
                            <span class="lbl_title">&#8226; Lot Number : </span>
                            <field name="finished_lot_id" context="{'default_product_id': product_id}"
                                   attrs="{'invisible': [('product_tracking', '=', 'none')]}"
                                   groups="stock.group_production_lot"  options="{'no_open': True}"
                                   class="final_lot"/>
                            <button name="call_gen_final_lot" context="{'default_workorder_id': id, 'default_gen_date': date_planned_start}"
                                    type="object" string="Generate New Lot Code"
                                    attrs="{'invisible': ['|', ('product_tracking', '=', 'none'), ('qty_producing', '=', 0)]}"
                                    class="oe_inline btn-info btn-lotcode oe_edit_only"/>
                            <!-- <button name="action_confirm" type="object" string="Finish Order"
                                context="{'clicked_finish': True}"
                                class="oe_inline btn-info btn-lotcode oe_edit_only"/> -->
                        </div>
                        <div class="box-date_start">
                            <span class="lbl_title">&#8226; Date : </span>
                            <field name="mo_time_start" readonly="1" string="" class="date_start" options="{'no_open': True}"/>
                        </div>

                    </div>

                    <div class="current_step_box">
                        <div class="workcenter"><field name="workcenter_id" readonly="1" string=""  options="{'no_open': True}"/></div>
                        <field name="current_step" string="" class="current_step"/>
                    </div>

                    <div style="float:left;width: 100% !important">
                        <group>
<!--                            <field name="select_lot_id_production"-->
<!--                                   options="{'no_quick_create':True, 'no_create_edit':True, 'no_create': True, 'create_edit': False}"-->
<!--                                   context="{'show_product_name': True, 'mrp_workorder': active_id }"-->
<!--                                   class = "select_lot"/>-->
                             <field name="select_lot_ids" widget="many2many_tags" options="{'no_quick_create':True, 'no_create_edit':True, 'no_create': True, 'create_edit': False}" context="{'show_product_name': True, 'mrp_workorder': id }" />
                        </group>
                        <!-- <div class="scrollable">
                            <field name="active_move_lot_ids" attrs="{'invisible': [('active_move_lot_ids', '=', [])]}">
                                <tree editable="bottom" create="0" delete="0" colors="#999:active_lot == False;" default_order="active_lot">
                                    <field name="product_id"/>
                                   <field name="single_material_used_amount" readonly="1"/>
                                    <field name="quantity" readonly="1"/>
                                    <field name="lot_id" domain="[(0,'=',1)]"
                                           options="{'no_quick_create':True, 'no_create_edit':True, 'no_create': True, 'create_edit': False}"
                                           context="{'default_product_id': product_id, 'mrp_workorder': active_id}"/>
                                   <field name="current_amount"/>
                                    <field name="quantity_done" />
                                    <field name="active_lot" invisible="1"/>
                                    <field name="move_id" invisible="1"/>
                                    <field name="production_id" invisible="1" />
                                    <field name="done_wo" invisible="1"/>
                                </tree>
                            </field>
                        </div> -->
                        
                        
                        <div class="scrollable">
                        
                        	<field name="move_line_ids" readonly="0" delete="false" create="false">
                        		<tree editable="bottom">
                        			<field name="product_id" />
                        			<field name="product_uom_qty" />
                                    <field name="lot_id" />
                                    <field name="qty_done" />
                                    <field name="owner_id" invisible="1"/>
                                    <field name="package_id" invisible="1"/>
                                    <field name="result_package_id" invisible="1"/>
                                    <field name="location_id" invisible="1"/>
                                    <field name="location_dest_id" invisible="1"/>
                                    <field name="product_uom_id" invisible="1"/>
                                    <field name="state" invisible="1"/>
                                    <field name="move_id" invisible="1"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="id" invisible="1"/>
                                </tree>
                        	</field>
                        	
                            <!-- <field name="move_raw_ids" readonly="1" options="{'no_quick_create':True, 'no_create_edit':True, 'no_create': True, 'create_edit': False}">
	                                <tree editable="bottom">
	                                    <field name="product_id" force_save="1" required="1" />
	                                    <field name="move_line_ids" invisible="1">
	                                        <tree>
	                                            <field name="lot_id" invisible="1"/>
	                                            <field name="owner_id" invisible="1"/>
	                                            <field name="package_id" invisible="1"/>
	                                            <field name="result_package_id" invisible="1"/>
	                                            <field name="location_id" invisible="1"/>
	                                            <field name="location_dest_id" invisible="1"/>
	                                            <field name="qty_done" invisible="1"/>
	                                            <field name="product_id" invisible="1"/>
	                                            <field name="product_uom_id" invisible="1"/>
	                                            <field name="product_uom_qty" invisible="1"/>
	                                            <field name="state" invisible="1"/>
	                                            <field name="move_id" invisible="1"/>
	                                            <field name="id" invisible="1"/>
	                                        </tree>
	                                    </field>
	
	                                    <field name="company_id" invisible="1"/>
	                                    <field name="product_uom_category_id" invisible="1"/>
	                                    <field name="name" invisible="1"/>
	                                    <field name="allowed_operation_ids" invisible="1"/>
	                                    <field name="unit_factor" invisible="1"/>
	                                    <field name="date_deadline" invisible="1"/>
	                                    <field name="date" invisible="1"/>
	                                    <field name="additional" invisible="1"/>
	                                    <field name="picking_type_id" invisible="1"/>
	                                    <field name="has_tracking" invisible="1"/>
	                                    <field name="operation_id" invisible="1"/>
	                                    <field name="is_done" invisible="1"/>
	                                    <field name="bom_line_id" invisible="1"/>
	                                    <field name="sequence" invisible="1"/>
	                                    <field name="location_id" invisible="1"/>
	                                    <field name="warehouse_id" invisible="1"/>
	                                    <field name="is_locked" invisible="1"/>
	                                    <field name="has_move_lines" invisible="1"/>
	                                    <field name="location_dest_id" invisible="1"/>
	                                    <field name="state" invisible="1" force_save="1"/>
	                                    <field name="should_consume_qty" invisible="1"/>
	                                    <field name="product_uom_qty" widget="mrp_should_consume" string="To Consume" width="1"/>
	                                    <field name="product_type" invisible="1"/>
	                                    <field name="product_qty" invisible="1" readonly="1"/>
	                                    <field name="reserved_availability" invisible="1"/>
	                                    <field name="forecast_expected_date" invisible="1"/>
	                                    <field name="forecast_availability" string="Reserved" attrs="{'column_invisible': [('parent.state', 'in', ['pending', 'done'])]}" widget="forecast_widget"/>
	                                    <field name="is_quantity_done_editable" invisible="1"/>
	                                    <field name="quantity_done" string="Consumed" decoration-success="not is_done and (quantity_done - should_consume_qty == 0)" decoration-warning="not is_done and (quantity_done - should_consume_qty &gt; 0.0001)" attrs="{'column_invisible': [('parent.state', '=', 'pending')], 'readonly': [('show_details_visible', '=', True)]}"/>
	                                    <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open': True, 'no_create': True}" groups="uom.group_uom"/>
	                                    <field name="show_details_visible" invisible="1"/>
	                                    <field name="lot_ids" widget="many2many_tags" string="LOT Numbers" groups="stock.group_production_lot" attrs="{'invisible': ['|', '|', ('show_details_visible', '=', False), ('has_tracking', '!=', 'serial'), ('parent.state', '=', 'draft')]}" context="{'default_company_id': company_id, 'default_product_id': product_id}" domain="[('product_id','=',product_id)]"/>
	                                    <button name="action_show_details" type="object" icon="fa-list" context="{'default_product_uom_qty': 0}" attrs="{'invisible': [('show_details_visible', '=', False)]}" options="{&quot;warn&quot;: true}"/>
	                                </tree>
	                            </field> -->
                        </div>
                        
                        
                        
                    </div>
<!--                    <div class="oe_read_only">-->
                    <div class="btn-left">
<!--                         <button name="button_finish" type="object" string="Finish Order"-->
<!--                                context="{'clicked_finish': True}"-->
<!--                                class="btn-info btn-big"-->
<!--                                attrs="{'invisible': [('state', '!=', 'progress')]}"-->
<!--                                confirm="Are you sure you want to do this?"/>-->
                        <button name="action_confirm" type="object" string="Finish Order"
                                context="{'clicked_finish': True}"
                                attrs="{'invisible': [('state', '!=', 'progress')]}"
                                class="btn-info btn-big"/>

                        <button name="button_start" type="object" string="Start Working"
                                class="btn-big"
                                attrs="{'invisible': ['|', ('working_state', '=', 'blocked'), ('state', '!=', 'pending')]}"/>

                        <button name="button_start" type="object" string="Start Working"
                                class="btn-success btn-big"
                                attrs="{'invisible': ['|', ('working_state', '=', 'blocked'), ('state', '!=', 'ready')]}"/>

<!--                        <button name="record_production" type="object" string="Done"-->
<!--                                class="btn-success btn-big"-->
<!--                                attrs="{'invisible': ['|', '|', '|', ('is_produced', '=', True), ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False)]}"/>-->
                    </div>
                    <div class="btn-right oe_edit_only">
                        <button name="record_production" type="object" string="Next"
                                class="btn-info btn-big"
                                attrs="{'invisible': ['|', '|', ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False)]}"/>
<!--                        <button name="record_production" type="object" string="Next"-->
<!--                                class="btn-info btn-big"-->
<!--                                attrs="{'invisible': ['|', '|', '|', ('is_produced', '=', True), ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False)]}"/>-->
                    </div>
<!--                    </div>-->
                </sheet>
            </form>
        </field>
    </record>
</odoo>

